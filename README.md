# Aisatsu-Function
<h1>あいさつアシスタント関数本体</h1>
<h2>プロジェクトの説明</h2>
<h3>このリポジトリについて</h3>
　このリポジトリには「あいさつアシスタント」の本体であるaisatsu関数のコードを載せています。

<h3>あいさつアシスタントの開発</h3>
「純粋倫理風」の挨拶をシーン別に提供するツールが、「あいさつアシスタント」です。
　純粋倫理とは（一社）倫理研究所が提唱する、守れば幸福になる厳然とした日常の法則、生活の法則(くらしみち)　のことです。<br>
　一方、最近話題になっているのが、Chat-GPT（チャットジーピーティー）などに代表される、大規模言語モデルと呼ばれるAIです。<br>
　あいさつアシスタントは、このAIに純粋倫理の知識を与えることによって、純粋倫理のエッセンスを持った、一味違う挨拶文を提案するものです。

<h2>このプロジェクトが有益な理由</h2>
<h3>挨拶って楽勝ですか？</h3>
　自治会長やPTA会長など、突然、組織や会の長になって、行事のたびに挨拶をしなければならず、それをプレッシャーに感じたことがある人は結構いるのではないでしょうか。<br>
　そんな時、挨拶原稿を一発で提案してくれるツールがあると助かると思います。
　確かに、Chat-GPTには元からそのような機能は備わっている訳ですが、純粋倫理のエッセンスをちりばめた一味違う挨拶文を提案できれば、純粋倫理をPRする機会になるのではないでしょうか？<br>
<h3>純粋倫理になじむチャンス</h3>
　挨拶に行き詰って困っているときに、（これから次々と出てくるであろう）挨拶文作成ツールの中で、純粋倫理系のツールは、多くの人の共感を得られると信じています。<br>
　言い換えればこのツールの愛用者は、純粋倫理の潜在的支持者であり、日常的に純粋倫理に触れて、馴染んでいる人たちと言えます。<br>
　そういった人たちを増やしていくことが、社会の中での純粋倫理の位置付けをより確かなものにしていくと共に、普及にも良い影響を与えていくものと思います。<br>
<h3>今日は最良の一日</h3>
　この手のツールは、一旦作ってしまえば費用も掛からず、ホームページやブログなどの客寄せに効果的なため、今後爆発的に増えることが予想されます。<br>
そのため出来るだけ早く始めて固定客をつかんでおかないと、増えてしまってからでは内容が良くても見向きもされなくなる可能性が高くなります。<br>
まさに「今日は最良の一日、今は無二の好機」なのです。<br>

<h2>aisatsu関数のしくみ</h2>
<h3>フューショットプロンプティング文章を生成</h3><p>
　aisatsu関数は、ユーザーが簡単な必要事項を入力すると、それを基に<abbr title="AIに問い合わせの内容やジャンルに関するキーワードその他の文の断片を与え、それに基づいてAIに新しいアイデアや文章を生成させる方法。">フューショットプロンプティング</abbr>用の問い合わせ文書を生成し、Chat-GPTに送り出します。<br>
　フュ－ショット用文書には挨拶内容に関連する純粋倫理のエッセンスが付加されており、Chat-GPTはそれを参考にして挨拶文を生成します。その結果、純粋倫理のエッセンスが効いた挨拶文が生成されるのです。<br>
　ここでのポイントは、ユーザーはChat-GPTへの問い合わせを直接行うのではなく、aisatsu関数に簡単な必要事項を入力するだけ、Chat-GPTへのの問い合わせはaisatsu関数が生成した文章で行う、という点にあります。</p>
 
<h3>埋め込み（embedding）を利用して純粋倫理のエッセンスを付加</h3>
<p>
　純粋倫理のエッセンスは、エッセンステーブルとも言える文章群から挨拶内容に関連性の高い文章が選び出されます。<br>
　関連性の高いエッセンスを選び出す方法として、埋め込み（embedding）という方法を利用しています。</p>

<h3>処理の流れ</h3>
<ol>
  <li>ユーザーが必要事項を入力する</li>
  <li>入力内容から関連性の高いエッセンス文章を選ぶ</li>
  <li>入力内容・選んだエッセンス文章に基づいて問い合わせ文章を生成</li>
  <li>Chat-GPTにより、純粋倫理のエッセンスが効いた挨拶文が生成される</li>
</ol>

<h3>主な仕様</h3><p>
　挨拶文の生成は、GPT-3.5-turboを使用しています。<br>
　プロンプトの埋め込み（embedding）には、text-embedding-3-smallを使用しています。<br>
　関数はGoogle Cloud Functions上でOpenAI API を使用して作られています。<br>
　コードはnode.js 18で書いています。<br>
　エッセンス文章は大野哲也の独断で収集しています。<br>
　エッセンス文書の埋め込み生成はada-002を使用しており、その機能はこのプロジェクトに含まれません。</p>

<h2>aisatsu関数の使い方</h2>
<h3>OpenAI APIに関する免責事項</h3>
　<p>このプロジェクトのAPIは大野哲也の個人アカウントのものを使用しており、API課金の支払いは大野哲也が行っています。<br>
　このアカウントには支払い金額の上限が設定されているため、上限を超えた場合、一時的に使用できなくなる場合があります。</p>
<h3>この関数のパラメーター</h3>
　<p>関数のURL　<code>https://us-central1-urinri2023.cloudfunctions.net/aisatsu</code><br>
　エントリポイント　<var>gogpt</var><br>
  <table>
   <caption>引数一覧</caption>
   <tr><th>変数の内容</th><th>説　明</th><th>形式</th></tr>
   <tr><td>挨拶する人の立場</td><td>普通名詞で表現されるような一般的な内容<br>特殊な内容は補足事項で補足する。</td><td>文字列形式</td></tr>
   <tr><td>挨拶の場面</td><td>普通名詞で表現されるような一般的な内容<br>特殊な内容は補足事項で補足する。</td><td>文字列形式</td></tr>
  </table>
　この関数は認証なしで使用できます。<br>
　コードの記述例<br>
  <code></code></p>
<h2>独自環境への導入</h2>
　このコードをご自分の環境で構築・デプロイすることで、エッセンス文章ファイルやプロンプトの生成プロセス、生成エンジンをカスタマイズできます。
<h3>OpenAI APIの準備</h3><p>
　OpenAI APIキーが準備出来ている場合は飛ばしてください。<br>　OpenAI APIキーがない場合、または新規に追加する場合は、<a href="https://platform.openai.com/signup">OpenAI アカウント</a>を作成するか、<a href="https://platform.openai.com/login">サインイン</a>します。<br>
　次に、<a href="https://platform.openai.com/account/api-keys">API キー ページ</a>に移動し、「新しい秘密キーを作成」し、必要に応じてキーに名前を付けます。<strong>※キーは一度しか表示されません。</strong><br>
　これを安全な場所に保存し、誰とも共有しないようにします。</p>
<h3>Node.jsのセットアップ</h3>
<h4>Node.jsをインストールする</h4>
　Node.jsがインストールされていなければ、<a href="https://nodejs.org/en/download">Node の公式 Web サイト</a>にアクセスし、LTS バージョンをダウンロードしてからインストールします。<br>
　<a href="https://nodejs.org/api/synopsis.html#usage">公式のNode.js使用ガイド</a>も参考にしてください。
<h4>Node.js　バージョンの確認とアップデート</h4>
  <p>Node.jsのバージョンを確認するにはターミナルで　<code>node --version</code>　または　<code>node -v</code>　を実行します。<br>
  Node.jsがインストールされていれば　<samp>v18.16.0</samp>　などと表示されます。<br>
  ちなみにNode.jsのパッケージを管理する「npm」も同様に確認できます<br>
  <code>npm --version<br>9.5.1</code><br>
  このプロジェクトではv18.16.0を使用しています。他のバージョンでの確認はしていません。<small>Node.jsのバージョン管理方法はいくつかあります。</small></p>
<h4>OpenAI Node.js ライブラリをインストールする</h4>
  <p>Node.js をインストールしたら、OpenAI Node.js ライブラリをインストールできます。ターミナル/コマンドラインから、次を実行します。<br>
  <code>npm install --save openai</code></p>
<h3>APIキーを設定する</h3><p>
　このプロジェクトでは、.envを使用しています。Node.js 18では<a href="https://www.npmjs.com/package/dotenv">dotenv</a>を使用する方法が一般的です。<br>
　ローカル環境（WindowsまたはMac）で使用する場合は、<a href="https://platform.openai.com/docs/quickstart/step-2-set-up-your-api-key">OSの環境変数を使用する方法</a>もあります。</p>
